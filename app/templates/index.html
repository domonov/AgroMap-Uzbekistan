<!DOCTYPE html>
<html>
<head>
    <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">
    <!-- rest of your head content -->
    <title>AgroMap Uzbekistan</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="language-selector">
    <div class="language-options">
        <button onclick="changeLanguage('en')" class="lang-btn {% if g.locale == 'en' %}active{% endif %}">
            <img src="{{ url_for('static', filename='images/flags/en.png') }}" alt="English"> EN
        </button>
        <button onclick="changeLanguage('uz')" class="lang-btn {% if g.locale == 'uz' %}active{% endif %}">
            <img src="{{ url_for('static', filename='images/flags/uz.png') }}" alt="O'zbek"> UZ
        </button>
        <button onclick="changeLanguage('ru')" class="lang-btn {% if g.locale == 'ru' %}active{% endif %}">
            <img src="{{ url_for('static', filename='images/flags/ru.png') }}" alt="Русский"> RU
        </button>
    </div>
</div>
    <div id="loading">Loading...</div>
    <div id="map"></div>
<!-- All other elements should be positioned absolute or fixed -->
    
    <div id="controls">
        <div id="layer-control">
            <button onclick="switchLayer('osm')">{{ _('Street') }}</button>
            <button onclick="switchLayer('satellite')">{{ _('Satellite') }}</button>
            <button onclick="switchLayer('terrain')">{{ _('Terrain') }}</button>
        </div>
        
        <div id="search-control">
            <input type="text" id="search-input" placeholder="{{ _('Search location...') }}">
            <button onclick="searchLocation()">{{ _('Search') }}</button>
        </div>
          <div id="trends-control">
            <button onclick="showTrendsModal()">{{ _('View Trends') }}</button>
            <button onclick="showSuggestionsModal()">{{ _('Suggest Location') }}</button>
            <button onclick="showMarketAnalysisModal()">{{ _('Market Analysis') }}</button>
            <button onclick="showAnalyticsDashboard()">{{ _('Analytics Dashboard') }}</button>
            <button onclick="showRotationPlanner()">{{ _('Crop Rotation Planner') }}</button>
        </div>
    </div>

    <div id="report-form" class="form-container">
        <h3>{{ _('Add/Edit Crop Report') }}</h3>
        <input type="hidden" id="report-id">
        <select id="crop-type" required>
            <option value="">{{ _('Select crop type') }}</option>
            <option value="wheat">{{ _('Wheat') }}</option>
            <option value="cotton">{{ _('Cotton') }}</option>
            <option value="potato">{{ _('Potato') }}</option>
        </select>
        
        <input type="number" id="field-size" placeholder="{{ _('Field size (hectares)') }}" 
           min="0.1" max="10000" step="0.1" required>
        
        <input type="text" id="planting-date" placeholder="{{ _('Planting date') }}">
        
        <input type="text" id="latitude" readonly>
        <input type="text" id="longitude" readonly>
        
        <button onclick="submitReport()">{{ _('Submit') }}</button>
        <button onclick="deleteReport()" id="delete-button" style="display: none;">{{ _('Delete') }}</button>
    </div>

    <div id="legend" class="legend">
        <h4>Crop Types</h4>
        <div class="legend-item">
            <img src="{{ url_for('static', filename='images/markers/wheat.png') }}" width="20"> Wheat
        </div>
        <div class="legend-item">
            <img src="{{ url_for('static', filename='images/markers/cotton.png') }}" width="20"> Cotton
        </div>
        <div class="legend-item">
            <img src="{{ url_for('static', filename='images/markers/potato.png') }}" width="20"> Potato
        </div>
    </div>

    <div id="location-status"></div>

    <!-- Trends Modal -->
    <div id="trends-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeTrendsModal()">&times;</span>
            <h2>{{ _('Crop Trends & Statistics') }}</h2>
            <div id="trends-content">
                <div id="crop-distribution"></div>
                <div id="price-predictions"></div>
                <div id="monthly-trends"></div>
            </div>
        </div>
    </div>

    <!-- Map Suggestions Modal -->
    <div id="suggestions-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeSuggestionsModal()">&times;</span>
            <h2>{{ _('Suggest Map Improvement') }}</h2>
            <form id="suggestion-form">
                <select id="suggestion-type" required>
                    <option value="">{{ _('Select type') }}</option>
                    <option value="street">{{ _('Street Name') }}</option>
                    <option value="building">{{ _('Building/Address') }}</option>
                    <option value="business">{{ _('Business/POI') }}</option>
                </select>
                <input type="text" id="suggestion-name" placeholder="{{ _('Name/Description') }}" required>
                <input type="text" id="suggestion-lat" readonly placeholder="{{ _('Latitude') }}">
                <input type="text" id="suggestion-lng" readonly placeholder="{{ _('Longitude') }}">
                <p class="help-text">{{ _('Click on the map to select location') }}</p>
                <button type="submit">{{ _('Submit Suggestion') }}</button>
            </form>
        </div>
    </div>

    <!-- Market Analysis Modal -->
    <div id="market-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeMarketAnalysisModal()">&times;</span>
            <h2>{{ _('Market Analysis & Recommendations') }}</h2>
            <div id="market-content">
                <div class="market-tabs">
                    <button class="tab-button active" onclick="showMarketTab('overview')">{{ _('Overview') }}</button>
                    <button class="tab-button" onclick="showMarketTab('recommendations')">{{ _('Recommendations') }}</button>
                    <button class="tab-button" onclick="showMarketTab('regional')">{{ _('Regional Analysis') }}</button>
                </div>
                
                <div id="market-overview" class="tab-content active">
                    <div id="crop-selector">
                        <label>{{ _('Select Crop:') }}</label>
                        <select id="analysis-crop-select" onchange="loadCropAnalysis()">
                            <option value="wheat">{{ _('Wheat') }}</option>
                            <option value="cotton">{{ _('Cotton') }}</option>
                            <option value="potato">{{ _('Potato') }}</option>
                            <option value="corn">{{ _('Corn') }}</option>
                            <option value="rice">{{ _('Rice') }}</option>
                        </select>
                    </div>
                    <div id="market-analysis-results"></div>
                </div>
                
                <div id="market-recommendations" class="tab-content">
                    <div id="planting-recommendations"></div>
                </div>
                
                <div id="market-regional" class="tab-content">
                    <div id="regional-analysis"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
<script>
// Add at the beginning of your HTML body
console.log("Document loading");

// Add right before the end of your HTML body
window.addEventListener('load', function() {
    console.log("Window loaded");
    console.log("Map element exists:", !!document.getElementById('map'));
    
    if (document.getElementById('map')) {
        console.log("Map dimensions:", document.getElementById('map').getBoundingClientRect());
    }
    
    console.log("Leaflet loaded:", typeof L !== 'undefined');
});
</script>
</body>
</html>